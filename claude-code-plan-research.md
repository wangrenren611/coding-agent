# Claude Code Plan åŠŸèƒ½è°ƒç ”æŠ¥å‘Š

## æ¦‚è¿°

æœ¬æŠ¥å‘ŠåŸºäº Anthropic å®˜æ–¹æ–‡æ¡£ã€æŠ€æœ¯è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œå¯¹ Claude Code çš„ Plan åŠŸèƒ½è¿›è¡Œäº†æ·±å…¥åˆ†æã€‚

---

## 1. Plan åŠŸèƒ½çš„æ ¸å¿ƒæµç¨‹

### 1.1 ä¸‰é˜¶æ®µ Agentic Loop

Claude Code çš„å·¥ä½œæµç¨‹åŸºäº"Agentic Loop"ï¼ˆä»£ç†å¾ªç¯ï¼‰ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š

```
ç”¨æˆ·æç¤º â†’ æ”¶é›†ä¸Šä¸‹æ–‡ â†’ æ‰§è¡Œæ“ä½œ â†’ éªŒè¯ç»“æœ â†’ (å¾ªç¯ç›´åˆ°ä»»åŠ¡å®Œæˆ)
```

**Plan Mode æ˜¯è¿™ä¸ªå¾ªç¯çš„ä¸€ä¸ªç‰¹æ®Šå˜ä½“**ï¼Œå®ƒåªæ‰§è¡Œç¬¬ä¸€é˜¶æ®µï¼ˆæ”¶é›†ä¸Šä¸‹æ–‡ï¼‰ï¼Œè€Œä¸è¿›å…¥æ‰§è¡Œå’ŒéªŒè¯é˜¶æ®µã€‚

### 1.2 Plan Mode çš„æ ¸å¿ƒæœºåˆ¶

Plan Mode çš„è®¾è®¡ç†å¿µæ˜¯**å°†æ¢ç´¢å’Œè§„åˆ’ä¸å®é™…æ‰§è¡Œåˆ†ç¦»**ï¼š

| é˜¶æ®µ | æ­£å¸¸æ¨¡å¼ | Plan Mode |
|------|----------|-----------|
| æ”¶é›†ä¸Šä¸‹æ–‡ | âœ… è¯»å–æ–‡ä»¶ã€æœç´¢ä»£ç  | âœ… è¯»å–æ–‡ä»¶ã€æœç´¢ä»£ç  |
| æ‰§è¡Œæ“ä½œ | âœ… ç¼–è¾‘æ–‡ä»¶ã€è¿è¡Œå‘½ä»¤ | âŒ åªè¯»æ“ä½œ |
| éªŒè¯ç»“æœ | âœ… è¿è¡Œæµ‹è¯•ã€éªŒè¯å˜æ›´ | âŒ ä»…ç”Ÿæˆè®¡åˆ’ |

**è§¦å‘æ–¹å¼ï¼š**
- é”®ç›˜å¿«æ·é”®ï¼š`Shift+Tab`ï¼ˆåœ¨ç»ˆç«¯ä¸­æŒ‰ä¸¤æ¬¡ï¼‰
- CLI å‚æ•°ï¼š`claude --permission-mode plan`
- ä¼šè¯å†…å‘½ä»¤ï¼š`/plan`
- Headless æ¨¡å¼ï¼š`claude --permission-mode plan -p "åˆ†æè®¤è¯ç³»ç»Ÿå¹¶å»ºè®®æ”¹è¿›"`

### 1.3 Plan Mode å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Plan Mode å·¥ä½œæµ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç”¨æˆ·è¾“å…¥ä»»åŠ¡æè¿°                                          â”‚
â”‚         â†“                                                    â”‚
â”‚  2. Claude ä½¿ç”¨ AskUserQuestion å·¥å…·æ”¶é›†éœ€æ±‚                  â”‚
â”‚         â†“                                                    â”‚
â”‚  3. Plan Subagent åœ¨åªè¯»æ¨¡å¼ä¸‹ç ”ç©¶ä»£ç åº“                       â”‚
â”‚         â†“                                                    â”‚
â”‚  4. ç”Ÿæˆè¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’                                        â”‚
â”‚         â†“                                                    â”‚
â”‚  5. ç”¨æˆ·å®¡æŸ¥è®¡åˆ’ï¼ˆå¯åœ¨ç¼–è¾‘å™¨ä¸­ç¼–è¾‘ï¼‰                           â”‚
â”‚         â†“                                                    â”‚
â”‚  6. ç”¨æˆ·æ‰¹å‡†ååˆ‡æ¢åˆ°æ‰§è¡Œæ¨¡å¼                                   â”‚
â”‚         â†“                                                    â”‚
â”‚  7. Claude æŒ‰è®¡åˆ’æ‰§è¡Œæ“ä½œ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Plan çš„ç”Ÿæˆã€å­˜å‚¨ä¸æ‰§è¡Œ

### 2.1 Plan ç”Ÿæˆæœºåˆ¶

Plan çš„ç”Ÿæˆä¾èµ–äº **Plan Subagent**ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…ç½®çš„ä¸“ç”¨å­ä»£ç†ï¼š

**Plan Subagent ç‰¹æ€§ï¼š**
- **æ¨¡å‹**ï¼šç»§æ‰¿è‡ªä¸»ä¼šè¯ï¼ˆå¯ä½¿ç”¨ `opusplan` ç­–ç•¥ï¼Œè§„åˆ’æ—¶ç”¨ Opusï¼Œæ‰§è¡Œæ—¶ç”¨ Sonnetï¼‰
- **å·¥å…·**ï¼šåªè¯»å·¥å…·ï¼ˆç¦æ­¢ Write å’Œ Edit å·¥å…·ï¼‰
- **ç›®çš„**ï¼šä»£ç åº“ç ”ç©¶å’Œè§„åˆ’

**ç”Ÿæˆè¿‡ç¨‹ï¼š**
1. Claude è¯†åˆ«éœ€è¦è§„åˆ’çš„å¤æ‚ä»»åŠ¡
2. è°ƒç”¨ Plan Subagent è¿›è¡Œä»£ç åº“æ¢ç´¢
3. Subagent è¿”å›ç ”ç©¶å‘ç°å’Œå»ºè®®
4. ä¸» Agent æ•´åˆä¿¡æ¯ç”Ÿæˆç»“æ„åŒ–è®¡åˆ’

### 2.2 Plan å­˜å‚¨æ–¹å¼

Plan æœ¬èº«ä¸æ˜¯æŒä¹…åŒ–å­˜å‚¨çš„ç‹¬ç«‹æ–‡ä»¶ï¼Œè€Œæ˜¯ä½œä¸º**ä¼šè¯æ¶ˆæ¯å†å²çš„ä¸€éƒ¨åˆ†**ï¼š

```
~/.claude/projects/{project}/{sessionId}/
â”œâ”€â”€ transcripts/           # ä¼šè¯è®°å½•
â”œâ”€â”€ subagents/            # å­ä»£ç†è®°å½•
â”‚   â””â”€â”€ agent-{agentId}.jsonl
â””â”€â”€ checkpoints/          # ä»£ç æ£€æŸ¥ç‚¹
```

**ç›¸å…³å­˜å‚¨æœºåˆ¶ï¼š**

| ç»„ä»¶ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|------|----------|------|
| ä¼šè¯å†å² | `~/.claude/projects/{project}/{sessionId}/` | åŒ…å« Plan å¯¹è¯ |
| ä»»åŠ¡åˆ—è¡¨ | `~/.claude/tasks/{team-name}/` | Agent Teams å…±äº«ä»»åŠ¡ |
| Team é…ç½® | `~/.claude/teams/{team-name}/config.json` | å¤šä»£ç†å›¢é˜Ÿé…ç½® |
| æ£€æŸ¥ç‚¹ | ä¼šè¯å†…å¿«ç…§ | æ–‡ä»¶ç¼–è¾‘å‰çš„ä»£ç å¿«ç…§ |

### 2.3 Plan æ‰§è¡Œ

Plan æ‰§è¡Œæœ‰ä¸¤ç§æ¨¡å¼ï¼š

**æ¨¡å¼ä¸€ï¼šç”¨æˆ·æ‰¹å‡†åæ‰§è¡Œ**
```bash
# 1. è¿›å…¥ Plan Mode
claude --permission-mode plan

# 2. Claude ç”Ÿæˆè®¡åˆ’
> "é‡æ„è®¤è¯ç³»ç»Ÿä»¥ä½¿ç”¨ OAuth2"

# 3. ç”¨æˆ·å®¡æŸ¥å¹¶æ‰¹å‡†è®¡åˆ’ï¼ˆCtrl+G å¯åœ¨ç¼–è¾‘å™¨ä¸­ç¼–è¾‘ï¼‰

# 4. åˆ‡æ¢åˆ°æ‰§è¡Œæ¨¡å¼ï¼ˆShift+Tabï¼‰
# 5. Claude æŒ‰è®¡åˆ’æ‰§è¡Œ
```

**æ¨¡å¼äºŒï¼šè‡ªåŠ¨æ¨¡å‹åˆ‡æ¢ï¼ˆopusplanï¼‰**
```
--model opusplan æ—¶çš„è¡Œä¸ºï¼š
â”œâ”€â”€ Plan Mode æ¿€æ´»æ—¶ â†’ ä½¿ç”¨ Opusï¼ˆæ·±åº¦æ¨ç†ï¼‰
â””â”€â”€ æ‰§è¡Œ Mode æ¿€æ´»æ—¶ â†’ è‡ªåŠ¨åˆ‡æ¢åˆ° Sonnetï¼ˆé«˜æ•ˆæ‰§è¡Œï¼‰
```

---

## 3. Plan ä¸ Agentã€å·¥å…·ç³»ç»Ÿçš„äº¤äº’

### 3.1 ä¸ Subagent ç³»ç»Ÿçš„äº¤äº’

Plan åŠŸèƒ½ä¸ Subagent ç³»ç»Ÿç´§å¯†é›†æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Subagent ç”Ÿæ€ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Explore   â”‚  â”‚    Plan     â”‚  â”‚  General-purpose    â”‚  â”‚
â”‚  â”‚  (Haiku)    â”‚  â”‚  (ç»§æ‰¿)     â”‚  â”‚     (ç»§æ‰¿)          â”‚  â”‚
â”‚  â”‚  åªè¯»å·¥å…·    â”‚  â”‚  åªè¯»å·¥å…·    â”‚  â”‚    æ‰€æœ‰å·¥å…·         â”‚  â”‚
â”‚  â”‚  å¿«é€Ÿæ¢ç´¢    â”‚  â”‚  è§„åˆ’ç ”ç©¶    â”‚  â”‚   å¤æ‚å¤šæ­¥ä»»åŠ¡       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†‘                â†‘                    â†‘              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                   â”‚
â”‚              ä¸» Agent æ ¹æ®ä»»åŠ¡ç±»å‹                            â”‚
â”‚              è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ Subagent                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å†…ç½® Subagent ç±»å‹ï¼š**

| Subagent | æ¨¡å‹ | å·¥å…·æƒé™ | ç”¨é€” |
|----------|------|----------|------|
| Explore | Haikuï¼ˆå¿«é€Ÿï¼‰ | åªè¯» | æ–‡ä»¶å‘ç°ã€ä»£ç æœç´¢ã€ä»£ç åº“æ¢ç´¢ |
| Plan | ç»§æ‰¿ | åªè¯» | Plan Mode ä¸‹çš„ä»£ç åº“ç ”ç©¶ |
| General-purpose | ç»§æ‰¿ | å…¨éƒ¨ | å¤æ‚ç ”ç©¶ã€å¤šæ­¥æ“ä½œã€ä»£ç ä¿®æ”¹ |
| Bash | ç»§æ‰¿ | Bash | åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­è¿è¡Œç»ˆç«¯å‘½ä»¤ |

**å…³é”®çº¦æŸï¼š** Subagent ä¸èƒ½ç”Ÿæˆå…¶ä»– Subagentï¼ˆé˜²æ­¢æ— é™åµŒå¥—ï¼‰

### 3.2 ä¸å·¥å…·ç³»ç»Ÿçš„äº¤äº’

**Plan Mode ä¸‹çš„å·¥å…·æƒé™ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å·¥å…·åˆ†ç±»ï¼ˆæŒ‰æƒé™ï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  ğŸŸ¢ å…è®¸ï¼ˆåªè¯»å·¥å…·ï¼‰          ğŸ”´ ç¦æ­¢ï¼ˆä¿®æ”¹å·¥å…·ï¼‰            â”‚
â”‚  â”œâ”€â”€ Read                    â”œâ”€â”€ Write                     â”‚
â”‚  â”œâ”€â”€ Grep                    â”œâ”€â”€ Edit                      â”‚
â”‚  â”œâ”€â”€ Glob                    â”œâ”€â”€ Bashï¼ˆå†™æ“ä½œï¼‰             â”‚
â”‚  â”œâ”€â”€ LSP å·¥å…·                â””â”€â”€ ä»»ä½•ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œ      â”‚
â”‚  â”œâ”€â”€ WebFetch                                              â”‚
â”‚  â””â”€â”€ WebSearch                                             â”‚
â”‚                                                            â”‚
â”‚  ğŸŸ¡ ç‰¹æ®Šå·¥å…·                                                â”‚
â”‚  â””â”€â”€ AskUserQuestionï¼ˆç”¨äºæ”¶é›†éœ€æ±‚ï¼‰                        â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æƒé™ç³»ç»Ÿäº¤äº’ï¼š**

Plan Mode æ˜¯æƒé™æ¨¡å¼çš„ä¸€ç§ï¼Œä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»ï¼š

| æ¨¡å¼ | è¡Œä¸º |
|------|------|
| `default` | æ ‡å‡†æƒé™æ£€æŸ¥ï¼Œé¦–æ¬¡ä½¿ç”¨å·¥å…·æ—¶æç¤º |
| `acceptEdits` | è‡ªåŠ¨æ¥å—æ–‡ä»¶ç¼–è¾‘æƒé™ |
| `plan` | **Plan Modeï¼šåªè¯»æ¢ç´¢ï¼Œä¸èƒ½ä¿®æ”¹æ–‡ä»¶æˆ–æ‰§è¡Œå‘½ä»¤** |
| `dontAsk` | è‡ªåŠ¨æ‹’ç»æœªé¢„å…ˆæ‰¹å‡†çš„å·¥å…· |
| `bypassPermissions` | è·³è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥ï¼ˆå±é™©ï¼‰ |

### 3.3 ä¸ Agent Teams çš„äº¤äº’

åœ¨ Agent Teams åœºæ™¯ä¸­ï¼ŒPlan å¯ä»¥ç”¨äº**è¦æ±‚ Teammates åœ¨å®æ–½å‰å…ˆè§„åˆ’**ï¼š

```
ç”Ÿæˆä¸€ä¸ªæ¶æ„å¸ˆ Teammate æ¥é‡æ„è®¤è¯æ¨¡å—ã€‚
è¦æ±‚ä»–ä»¬åœ¨åšä»»ä½•æ›´æ”¹å‰å…ˆè·å¾—è®¡åˆ’æ‰¹å‡†ã€‚
```

**æµç¨‹ï¼š**
1. Teammate åœ¨ Plan Mode ä¸‹å·¥ä½œ
2. å®Œæˆè§„åˆ’åå‘é€è®¡åˆ’æ‰¹å‡†è¯·æ±‚ç»™ Lead
3. Lead å®¡æŸ¥å¹¶æ‰¹å‡†/æ‹’ç»
4. æ‰¹å‡†å Teammate é€€å‡º Plan Mode å¼€å§‹å®æ–½

---

## 4. Plan çš„æ•°æ®ç»“æ„å’ŒçŠ¶æ€ç®¡ç†

### 4.1 æ ¸å¿ƒæ•°æ®ç»“æ„

è™½ç„¶å®˜æ–¹æ–‡æ¡£æœªå…¬å¼€ Plan çš„ç¡®åˆ‡ JSON Schemaï¼Œä½†æ ¹æ®åŠŸèƒ½æè¿°å¯æ¨æ–­ï¼š

**ä»»åŠ¡åˆ—è¡¨æ•°æ®ç»“æ„ï¼ˆAgent Teamsï¼‰ï¼š**
```
~/.claude/tasks/{team-name}/
â”œâ”€â”€ task-{id}.json       # ä»»åŠ¡å®šä¹‰
â””â”€â”€ state.json           # çŠ¶æ€è·Ÿè¸ª
```

**ä»»åŠ¡çŠ¶æ€ï¼š**
- `pending` - ç­‰å¾…å¤„ç†
- `in_progress` - è¿›è¡Œä¸­
- `completed` - å·²å®Œæˆ
- `blocked` - è¢«é˜»å¡ï¼ˆä¾èµ–å…¶ä»–ä»»åŠ¡ï¼‰

**ä»»åŠ¡ä¾èµ–å…³ç³»ï¼š**
- ä»»åŠ¡å¯ä»¥ä¾èµ–å…¶ä»–ä»»åŠ¡
- è¢«ä¾èµ–çš„ä»»åŠ¡å®Œæˆåï¼Œé˜»å¡è‡ªåŠ¨è§£é™¤
- ä½¿ç”¨æ–‡ä»¶é”é˜²æ­¢ç«äº‰æ¡ä»¶

### 4.2 çŠ¶æ€ç®¡ç†æœºåˆ¶

**ä¼šè¯çº§çŠ¶æ€ï¼š**
```
Session State
â”œâ”€â”€ permissionMode: "plan" | "default" | "acceptEdits" | ...
â”œâ”€â”€ currentModel: "opus" | "sonnet" | "opusplan" | ...
â”œâ”€â”€ contextWindow: { used, max }
â”œâ”€â”€ checkpoints: [ { timestamp, files, messageId } ]
â””â”€â”€ tasks: [ { id, status, dependencies, assignee } ]
```

**Plan Mode çŠ¶æ€è½¬æ¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Shift+Tab     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Shift+Tab    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Default  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ AcceptEditâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   Plan    â”‚
â”‚   Mode    â”‚                  â”‚   Mode    â”‚                  â”‚   Mode    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                                            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Shift+Tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Context ç®¡ç†

**Plan ç›¸å…³çš„ä¸Šä¸‹æ–‡æ¶ˆè€—ï¼š**

| ç»„ä»¶ | åŠ è½½æ—¶æœº | ä¸Šä¸‹æ–‡æˆæœ¬ |
|------|----------|------------|
| CLAUDE.md | ä¼šè¯å¼€å§‹ | æ¯æ¬¡è¯·æ±‚ |
| Plan Subagent | è§„åˆ’ä»»åŠ¡æ—¶ | ç‹¬ç«‹ä¸Šä¸‹æ–‡ |
| Skillsï¼ˆæè¿°ï¼‰ | ä¼šè¯å¼€å§‹ | ä½ï¼ˆä»…æè¿°ï¼‰ |
| Skillsï¼ˆå®Œæ•´ï¼‰ | è°ƒç”¨æ—¶ | å®Œæ•´å†…å®¹ |

**Compaction æœºåˆ¶ï¼š**
- è‡ªåŠ¨åœ¨ ~95% å®¹é‡æ—¶è§¦å‘
- é¦–å…ˆæ¸…ç†æ—§çš„å·¥å…·è¾“å‡º
- å¿…è¦æ—¶æ€»ç»“å¯¹è¯
- ä¿ç•™ç”¨æˆ·è¯·æ±‚å’Œå…³é”®ä»£ç ç‰‡æ®µ

---

## 5. ç”¨æˆ·ä¸ Plan çš„äº¤äº’æ–¹å¼

### 5.1 åˆ›å»º Plan

**æ–¹å¼ä¸€ï¼šäº¤äº’å¼ä¼šè¯**
```
# å¯åŠ¨æ—¶è¿›å…¥ Plan Mode
claude --permission-mode plan

# æˆ–åœ¨ä¼šè¯ä¸­åˆ‡æ¢
Shift+Tab â†’ Shift+Tab

# æˆ–ä½¿ç”¨å‘½ä»¤
/plan
```

**æ–¹å¼äºŒï¼šHeadless æ¨¡å¼**
```bash
# ä¸€æ¬¡æ€§è§„åˆ’ä»»åŠ¡
claude --permission-mode plan -p "åˆ†æè®¤è¯ç³»ç»Ÿå¹¶å»ºè®®æ”¹è¿›"
```

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨ opusplan æ¨¡å‹**
```bash
# è‡ªåŠ¨åœ¨è§„åˆ’å’Œæ‰§è¡Œé—´åˆ‡æ¢æ¨¡å‹
claude --model opusplan
```

### 5.2 å®¡æŸ¥å’Œä¿®æ”¹ Plan

**äº¤äº’åŠŸèƒ½ï¼š**

| æ“ä½œ | æ–¹å¼ |
|------|------|
| æŸ¥çœ‹è®¡åˆ’ | è®¡åˆ’æ˜¾ç¤ºåœ¨ä¼šè¯ä¸­ |
| ç¼–è¾‘è®¡åˆ’ | `Ctrl+G` åœ¨é»˜è®¤ç¼–è¾‘å™¨ä¸­æ‰“å¼€ |
| è°ƒæ•´æ–¹å‘ | é€šè¿‡å¯¹è¯è¿­ä»£ç»†åŒ– |
| è¯¢é—®ç»†èŠ‚ | ç›´æ¥æé—® |

**è¿­ä»£è§„åˆ’ç¤ºä¾‹ï¼š**
```
> æˆ‘éœ€è¦é‡æ„è®¤è¯ç³»ç»Ÿä»¥ä½¿ç”¨ OAuth2
[Claude ç”Ÿæˆè®¡åˆ’]

> å‘åå…¼å®¹æ€§æ€ä¹ˆå¤„ç†ï¼Ÿ
[Claude è¡¥å……è®¡åˆ’]

> æ•°æ®åº“è¿ç§»åº”è¯¥æ€ä¹ˆåšï¼Ÿ
[Claude è¿›ä¸€æ­¥ç»†åŒ–]
```

### 5.3 æ‰§è¡Œ Plan

**æ‰¹å‡†å¹¶æ‰§è¡Œï¼š**
1. å®¡æŸ¥è®¡åˆ’æ»¡æ„å
2. æŒ‰ `Shift+Tab` é€€å‡º Plan Mode
3. Claude æŒ‰è®¡åˆ’æ‰§è¡Œæ“ä½œ
4. å¯éšæ—¶ä¸­æ–­å’Œè°ƒæ•´

**æ‰§è¡Œç›‘æ§ï¼š**
- `Ctrl+T`ï¼šåˆ‡æ¢ä»»åŠ¡åˆ—è¡¨è§†å›¾
- `Esc`ï¼šä¸­æ–­å½“å‰æ“ä½œ
- `Esc+Esc`ï¼šæ‰“å¼€ Rewind èœå•

### 5.4 è·Ÿè¸ªè¿›åº¦

**ä»»åŠ¡åˆ—è¡¨åŠŸèƒ½ï¼š**
- è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†ä»»åŠ¡
- æ˜¾ç¤º pending/in_progress/completed çŠ¶æ€
- è·¨ context compaction æŒä¹…åŒ–
- æœ€å¤šæ˜¾ç¤º 10 ä¸ªä»»åŠ¡

**ä¼šè¯ç®¡ç†ï¼š**
```bash
# å‘½åä¼šè¯ä»¥ä¾¿åç»­æ¢å¤
/rename auth-refactor

# æ¢å¤ä¼šè¯
claude --resume auth-refactor

# Fork ä¼šè¯å°è¯•ä¸åŒæ–¹æ¡ˆ
claude --continue --fork-session
```

### 5.5 Rewind å’Œæ¢å¤

**æ£€æŸ¥ç‚¹æœºåˆ¶ï¼š**
- æ¯æ¬¡ç”¨æˆ·æç¤ºåˆ›å»ºæ–°æ£€æŸ¥ç‚¹
- è·¨ä¼šè¯æŒä¹…åŒ–
- 30 å¤©åè‡ªåŠ¨æ¸…ç†ï¼ˆå¯é…ç½®ï¼‰

**Rewind é€‰é¡¹ï¼š**
1. **æ¢å¤ä»£ç å’Œå¯¹è¯**ï¼šå›æ»šåˆ°é€‰å®šçŠ¶æ€
2. **ä»…æ¢å¤å¯¹è¯**ï¼šä¿ç•™å½“å‰ä»£ç 
3. **ä»…æ¢å¤ä»£ç **ï¼šä¿ç•™å½“å‰å¯¹è¯
4. **ä»æ­¤å¤„æ€»ç»“**ï¼šå‹ç¼©åç»­å¯¹è¯

---

## 6. æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 6.1 åˆ†ç¦»å…³æ³¨ç‚¹

Plan Mode çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯**å°†è§„åˆ’ä¸æ‰§è¡Œåˆ†ç¦»**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è®¾è®¡å“²å­¦                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  "æ¢ç´¢ä¼˜äºå®æ–½"                                              â”‚
â”‚  â”œâ”€â”€ å…ˆç†è§£ä»£ç åº“ï¼Œå†ä¿®æ”¹ä»£ç                                 â”‚
â”‚  â”œâ”€â”€ å¤æ‚å˜æ›´å‰å…ˆåˆ¶å®šè®¡åˆ’                                    â”‚
â”‚  â””â”€â”€ ç”¨æˆ·å®¡æŸ¥åå†æ‰§è¡Œ                                        â”‚
â”‚                                                             â”‚
â”‚  "ä¸Šä¸‹æ–‡éš”ç¦»"                                                â”‚
â”‚  â”œâ”€â”€ Subagent æœ‰ç‹¬ç«‹ä¸Šä¸‹æ–‡çª—å£                               â”‚
â”‚  â”œâ”€â”€ ç ”ç©¶è¾“å‡ºä¸ä¼šè†¨èƒ€ä¸»ä¼šè¯                                  â”‚
â”‚  â””â”€â”€ åªè¿”å›æ‘˜è¦ç»™ä¸» Agent                                    â”‚
â”‚                                                             â”‚
â”‚  "å¯ä¸­æ–­æ€§"                                                  â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ·éšæ—¶å¯ä¸­æ–­                                          â”‚
â”‚  â”œâ”€â”€ å¯è¿­ä»£ç»†åŒ–è®¡åˆ’                                          â”‚
â”‚  â””â”€â”€ æ”¯æŒåˆ†æ”¯æ¢ç´¢ï¼ˆforkï¼‰                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æœ€ä½³å®è·µ

**ä½•æ—¶ä½¿ç”¨ Plan Modeï¼š**
- å¤šæ­¥éª¤å®ç°ï¼ˆéœ€è¦ç¼–è¾‘å¤šä¸ªæ–‡ä»¶ï¼‰
- ä»£ç æ¢ç´¢ï¼ˆå½»åº•ç ”ç©¶åå†ä¿®æ”¹ï¼‰
- äº¤äº’å¼å¼€å‘ï¼ˆä¸ Claude è¿­ä»£è®¨è®ºæ–¹å‘ï¼‰
- å¤æ‚é‡æ„ï¼ˆéœ€è¦æ¶æ„å†³ç­–ï¼‰

**Plan Mode é…ç½®ä¸ºé»˜è®¤ï¼š**
```json
// .claude/settings.json
{
  "permissions": {
    "defaultMode": "plan"
  }
}
```

### 6.3 ä¸å…¶ä»–åŠŸèƒ½çš„å¯¹æ¯”

| åŠŸèƒ½ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| **Plan Mode** | è§„åˆ’å¤æ‚å˜æ›´ | åªè¯»æ¢ç´¢ï¼Œç”Ÿæˆè®¡åˆ’ |
| **Subagent** | ä¸Šä¸‹æ–‡éš”ç¦» | ç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼Œè¿”å›æ‘˜è¦ |
| **Agent Teams** | å¹¶è¡Œåä½œ | å¤š Agent é€šä¿¡åè°ƒ |
| **Skills** | å¯å¤ç”¨çŸ¥è¯† | æŒ‰éœ€åŠ è½½ï¼Œå¯è§¦å‘å·¥ä½œæµ |
| **CLAUDE.md** | æŒä¹…ä¸Šä¸‹æ–‡ | æ¯æ¬¡ä¼šè¯åŠ è½½ |

---

## 7. å®ç°è¦ç‚¹æ€»ç»“

### 7.1 æŠ€æœ¯æ¶æ„

```
Claude Code æ¶æ„å±‚æ¬¡
â”œâ”€â”€ æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ Claude æ¨¡å‹ï¼ˆæ¨ç†ï¼‰
â”‚   â””â”€â”€ æ¨¡å‹åˆ«åï¼ˆsonnet/opus/opusplanï¼‰
â”œâ”€â”€ Agent å±‚
â”‚   â”œâ”€â”€ ä¸» Agentï¼ˆä¼šè¯ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ Subagent ç³»ç»Ÿï¼ˆä»»åŠ¡å§”æ‰˜ï¼‰
â”‚   â””â”€â”€ Agent Teamsï¼ˆå¤š Agent åè°ƒï¼‰
â”œâ”€â”€ å·¥å…·å±‚
â”‚   â”œâ”€â”€ å†…ç½®å·¥å…·ï¼ˆRead/Write/Edit/Bash/Grep/...ï¼‰
â”‚   â”œâ”€â”€ MCP å·¥å…·ï¼ˆå¤–éƒ¨æœåŠ¡ï¼‰
â”‚   â””â”€â”€ Skill å·¥å…·ï¼ˆçŸ¥è¯†æ³¨å…¥ï¼‰
â”œâ”€â”€ æƒé™å±‚
â”‚   â”œâ”€â”€ Permission Modeï¼ˆplan/default/acceptEdits/...ï¼‰
â”‚   â””â”€â”€ æƒé™è§„åˆ™ï¼ˆallow/ask/denyï¼‰
â””â”€â”€ çŠ¶æ€å±‚
    â”œâ”€â”€ ä¼šè¯çŠ¶æ€ï¼ˆæ£€æŸ¥ç‚¹/å†å²ï¼‰
    â””â”€â”€ ä»»åŠ¡çŠ¶æ€ï¼ˆpending/in_progress/completedï¼‰
```

### 7.2 å…³é”®äº¤äº’ç‚¹

1. **Plan ç”Ÿæˆ**ï¼šPlan Subagent + åªè¯»å·¥å…·
2. **Plan å­˜å‚¨**ï¼šä¼šè¯å†å²ï¼ˆéç‹¬ç«‹æ–‡ä»¶ï¼‰
3. **Plan æ‰§è¡Œ**ï¼šæƒé™æ¨¡å¼åˆ‡æ¢ + æ¨¡å‹åˆ‡æ¢ï¼ˆopusplanï¼‰
4. **è¿›åº¦è·Ÿè¸ª**ï¼šä»»åŠ¡åˆ—è¡¨ + æ£€æŸ¥ç‚¹
5. **ç”¨æˆ·äº¤äº’**ï¼šå®¡æŸ¥/ç¼–è¾‘/æ‰¹å‡†/Rewind

### 7.3 æ‰©å±•ç‚¹

- **è‡ªå®šä¹‰ Subagent**ï¼š`.claude/agents/` æˆ– `~/.claude/agents/`
- **è‡ªå®šä¹‰ Skills**ï¼š`.claude/skills/` æˆ– `~/.claude/skills/`
- **Hooks**ï¼šç”Ÿå‘½å‘¨æœŸäº‹ä»¶é’©å­
- **MCP Server**ï¼šå¤–éƒ¨å·¥å…·é›†æˆ
- **Plugins**ï¼šåŠŸèƒ½æ‰“åŒ…åˆ†å‘

---

## 8. å‚è€ƒèµ„æº

- [Claude Code å®˜æ–¹æ–‡æ¡£](https://docs.anthropic.com/en/docs/claude-code/overview)
- [Claude Code æ–‡æ¡£ç´¢å¼•](https://code.claude.com/docs/llms.txt)
- [Common Workflows - Plan Mode](https://code.claude.com/docs/en/common-workflows.md)
- [Subagents æ–‡æ¡£](https://code.claude.com/docs/en/sub-agents.md)
- [Agent Teams æ–‡æ¡£](https://code.claude.com/docs/en/agent-teams.md)
- [Model Configuration](https://code.claude.com/docs/en/model-config.md)
- [Permissions æ–‡æ¡£](https://code.claude.com/docs/en/permissions.md)
- [Skills æ–‡æ¡£](https://code.claude.com/docs/en/skills.md)
- [Interactive Mode](https://code.claude.com/docs/en/interactive-mode.md)
- [CLI Reference](https://code.claude.com/docs/en/cli-reference.md)

---

## é™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# Plan Mode ç›¸å…³
claude --permission-mode plan          # å¯åŠ¨æ—¶è¿›å…¥ Plan Mode
claude --model opusplan                # ä½¿ç”¨ Opus è§„åˆ’ + Sonnet æ‰§è¡Œ
/plan                                  # ä¼šè¯å†…è¿›å…¥ Plan Mode
Shift+Tab (ä¸¤æ¬¡)                       # åˆ‡æ¢åˆ° Plan Mode

# ä¼šè¯ç®¡ç†
claude --continue                      # ç»§ç»­æœ€è¿‘ä¼šè¯
claude --resume <name>                 # æ¢å¤å‘½åä¼šè¯
claude --continue --fork-session       # Fork ä¼šè¯
/rename <name>                         # å‘½åå½“å‰ä¼šè¯

# ä»»åŠ¡å’Œè¿›åº¦
Ctrl+T                                 # åˆ‡æ¢ä»»åŠ¡åˆ—è¡¨
Ctrl+O                                 # åˆ‡æ¢è¯¦ç»†è¾“å‡º
Esc+Esc                                # æ‰“å¼€ Rewind èœå•
/rewind                                # Rewind å‘½ä»¤

# é…ç½®
/permissions                           # ç®¡ç†æƒé™
/model                                 # åˆ‡æ¢æ¨¡å‹
/config                                # æ‰“å¼€è®¾ç½®
```

---

*æŠ¥å‘Šç”Ÿæˆæ—¥æœŸï¼š2025å¹´7æœˆ*
